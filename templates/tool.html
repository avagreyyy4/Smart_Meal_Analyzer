{% extends 'base.html' %}
{% block title %}Meal Tool{% endblock %}
{% block content %}
<div style="display:flex; gap:2em;">
  <div style="flex:2;">
    <h1>Meal Builder</h1>
    <form method="post">
      <input type="hidden" name="action" value="search">
      <label for="query">Search Foods:</label>
      <input type="text" id="query" name="query" required>
      <button type="submit">Search</button>
    </form>

    {% if results %}
    <h2>Results</h2>
    <ul>
    {% for food in results %}
      <li>
        {{ food.description }}
        <form method="post" style="display:inline">
          <input type="hidden" name="action" value="add">
          <input type="hidden" name="fdc_id" value="{{ food.fdcId }}">
          <input type="hidden" name="food_name" value="{{ food.description }}">
          <input type="number" name="grams" value="100" min="1" style="width:60px">
          <button type="submit">Add</button>
        </form>
      </li>
    {% endfor %}
    </ul>
    {% endif %}

    {% if meal_list %}
    <h2>Your Meal</h2>
    <ul>
    {% for item in meal_list %}
      <li>
        {{ item.name }} - {{ item.calories }} kcal, {{ item.protein }}g protein, {{ item.carbs }}g carbs, {{ item.fat }}g fat, {{ item.sugar }}g sugar
        <form method="post" style="display:inline">
          <input type="hidden" name="action" value="remove">
          <input type="hidden" name="index" value="{{ loop.index0 }}">
          <button type="submit">Remove</button>
        </form>
      </li>
    {% endfor %}
    </ul>

    <h3>Totals</h3>
    <ul>
      <li>Calories: {{ total.calories }}</li>
      <li>Protein: {{ total.protein }}</li>
      <li>Carbs: {{ total.carbs }}</li>
      <li>Fat: {{ total.fat }}</li>
      <li>Sugar: {{ total.sugar }}</li>
    </ul>

    {% if warnings %}
    <h3>Nutritional Warnings</h3>
    <ul>
    {% for w in warnings %}
      <li>{{ w }}</li>
    {% endfor %}
    </ul>
    {% endif %}

    <form method="post">
      <input type="hidden" name="action" value="complete">
      <button type="submit">This is my complete meal</button>
    </form>
    {% endif %}

    {% if advice %}
    <h3>Advice for Improving Your Meal</h3>
    <p>{{ advice }}</p>
    {% endif %}
  </div>

  <div style="flex:1;">
    <h4>Serving Size Reference (Typical Per-Person Amounts)</h4>
    <table border="1" cellpadding="6" cellspacing="0">
      <thead>
        <tr><th>Food Type</th><th>Typical Serving</th><th>Approx. Grams</th></tr>
      </thead>
      <tbody>
        <tr><td>Fruit (whole)</td><td>1 medium apple, banana</td><td>150 g</td></tr>
        <tr><td>Berries</td><td>1 cup</td><td>125 g</td></tr>
        <tr><td>Leafy Greens (raw)</td><td>1 cup</td><td>30 g</td></tr>
        <tr><td>Leafy Greens (cooked)</td><td>½ cup</td><td>90 g</td></tr>
        <tr><td>Vegetables (raw)</td><td>½ cup</td><td>70 g</td></tr>
        <tr><td>Vegetables (cooked)</td><td>½ cup</td><td>85 g</td></tr>
        <tr><td>Rice (cooked)</td><td>½ cup</td><td>125 g</td></tr>
        <tr><td>Rice (dry)</td><td>¼ cup</td><td>45 g</td></tr>
        <tr><td>Pasta (cooked)</td><td>½ cup</td><td>120 g</td></tr>
        <tr><td>Pasta (dry)</td><td>¼ cup</td><td>50 g</td></tr>
        <tr><td>Bread</td><td>1 slice</td><td>30 g</td></tr>
        <tr><td>Tortilla (medium)</td><td>1 piece</td><td>40–60 g</td></tr>
        <tr><td>Cheese</td><td>1 slice / 1 oz cube</td><td>28 g</td></tr>
        <tr><td>Milk / Yogurt</td><td>1 cup</td><td>240 g</td></tr>
        <tr><td>Canned Beans</td><td>½ cup (drained)</td><td>130 g</td></tr>
        <tr><td>Meat / Fish (raw)</td><td>Palm-sized piece</td><td>120 g</td></tr>
        <tr><td>Meat / Fish (cooked)</td><td>Deck-of-cards size</td><td>85 g</td></tr>
        <tr><td>Tofu</td><td>½ cup</td><td>126 g</td></tr>
        <tr><td>Eggs</td><td>1 large</td><td>50 g</td></tr>
        <tr><td>Nuts</td><td>Small handful</td><td>28 g</td></tr>
        <tr><td>Nut Butter</td><td>1 tbsp</td><td>16 g</td></tr>
        <tr><td>Condiments (e.g. ketchup)</td><td>1 tbsp</td><td>15 g</td></tr>
        <tr><td>Oils / Butter</td><td>1 tbsp</td><td>14 g</td></tr>
        <tr><td>Soda / Juice</td><td>1 can (12 oz)</td><td>355 g</td></tr>
        <tr><td>Candy</td><td>1 bar / 10-20 pieces</td><td>45 g / 8-16 g</td></tr>
        <tr><td>Cake / Pie</td><td>1 slice</td><td>100-150 g</td></tr>
        <tr><td>Pancake / Waffle</td><td>1 Pancake / 1 Waffle</td><td>30-100 g</td></tr>
      </tbody>
    </table>
  </div>
</div>
<hr>
<p style="text-align:center;font-size:0.8em;">2025 Smart Meal Helper</p>
{% endblock %}
