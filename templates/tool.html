{% extends 'base.html' %}
{% block title %}Meal Tool{% endblock %}
{% block content %}
<div style="display:flex; gap:2em;">
  <!-- LEFT: Meal Tool Builder -->
  <div style="flex:2;">
    <h1>Meal Builder</h1>
    <form method="post" id="add-form">
      <input type="hidden" name="action" value="add">
      <label for="query">Search Foods:</label>
      <input type="text" id="query" list="suggestions" class="food-search" autocomplete="off" required>
      <datalist id="suggestions"></datalist>
      <input type="hidden" name="fdc_id" id="fdc_id">
      <input type="hidden" name="food_name" id="food_name">
      <input type="number" name="grams" value="100" min="1" style="width:60px">
      <button type="submit">Add</button>
    </form>

    {% if meal_list %}
    <h2>Your Meal</h2>
    <ul>
    {% for item in meal_list %}
      <li>
        {{ item.name }} - {{ item.calories }} kcal, {{ item.protein }}g protein, {{ item.carbs }}g carbs, {{ item.fat }}g fat, {{ item.sugar }}g sugar
        <form method="post" style="display:inline">
          <input type="hidden" name="action" value="remove">
          <input type="hidden" name="index" value="{{ loop.index0 }}">
          <button type="submit">Remove</button>
        </form>
      </li>
    {% endfor %}
    </ul>

    <h3>Totals</h3>
    <table>
      <thead>
        <tr>
          <th>Calories</th>
          <th>Protein</th>
          <th>Carbs</th>
          <th>Fat</th>
          <th>Sugar</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>{{ total.calories }}</td>
          <td>{{ total.protein }}</td>
          <td>{{ total.carbs }}</td>
          <td>{{ total.fat }}</td>
          <td>{{ total.sugar }}</td>
        </tr>
      </tbody>
    </table>

    {% if warnings %}
    <div class="alert alert-warning">
      <h3>Nutritional Warnings</h3>
      <ul>
      {% for w in warnings %}
        <li>{{ w }}</li>
      {% endfor %}
      </ul>
    </div>
    {% endif %}

    <form method="post" id="complete-form">
      <input type="hidden" name="action" value="complete">
        
      <button type="submit">This is my complete meal</button>
    </form>
    {% endif %}
      
    <div id="thinking">Thinking...</div>
      
    {% if advice %}
    <div class="alert alert-info">
      <h3>Advice for Improving Your Meal</h3>
      <p>{{ advice }}</p>
    </div>
    {% endif %}
  </div>

  <!-- RIGHT: Reference Table -->
  <div style="flex:1;">
    <h4>Serving Size Reference (Typical Per-Person Amounts)</h4>
    <table border="1" cellpadding="6" cellspacing="0">
      <thead>
        <tr><th>Food Type</th><th>Typical Serving</th><th>Approx. Grams</th></tr>
      </thead>
      <tbody>
        <!-- truncated for brevity â€” you can keep all rows as you had them -->
        <tr><td>Fruit (whole)</td><td>1 medium apple, banana</td><td>150 g</td></tr>
        <tr><td>Berries</td><td>1 cup</td><td>125 g</td></tr>
        <tr><td>Leafy Greens (raw)</td><td>1 cup</td><td>30 g</td></tr>
        <!-- ... the rest ... -->
      </tbody>
    </table>
  </div>
</div>
<hr>
<p style="text-align:center;font-size:0.8em;">2025 Smart Meal Helper</p>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='search.js') }}"></script>
{% endblock %}